---
title: "Quarto projects for advanced content"
subtitle: "Enhancing scientific publishing through Quarto"
institute: "Posit"
author: "Christophe Dervieux"
date: "2024-07-08"
format: clean-revealjs
code-line-numbers: false
editor: visual
lightbox: true
---

```{r}
#| label: setup
#| include: false

options(width = 65)

library(countdown)
```

## Projet Quarto ?

Quarto projects are **directories** that provide :

::: incremental
* a way to `render` all or part of the files in a directory using a single command (for example, `quarto render myproject`).
* A means of sharing YAML configuration between several documents.
* The ability to redirect output artifacts to another directory.
* The ability to freeze rendering (i.e. not re-run documents unless they have changed).
:::

## We've already created a project...

A project is a directory with a `_quarto.yml`, no matter how simple.

``` {.yaml filename="_quarto.yml"}
project:
  title: "Quarto-101"
```

![](images/quarto-project.png){fig-alt="Files panel in RStudio showing my-doc.qmd and _quarto.yml."}




## Which projects can be created ?

Projects can have special "types" that introduce additional behavior (for example, websites or books).

``` bash
$ quarto create project
? Type
‚ùØ default
  website
  blog
  manuscript
  book
  confluence
```

## Quarto Website

- Arbitrary depth and organization of content
- Multi-level navigation (navigation bar / sidebar / hybrid)
- Full-text search (client-side or Algolia)
- Freeze calculation results (`freeze` configuration)

## Quarto Website

``` {.yaml filename="_quarto.yml" code-line-numbers="|2|4-5|6-10|12-15"}
project:
  type: website

website:
  title: "today"
  navbar:
    left:
      - href: index.qmd
        text: Home
      - about.qmd

format:
  html:
    theme: cosmo
    toc: true
```

::: aside
Example: <https://quarto.org> and more in the [Gallery](https://quarto.org/docs/gallery/#websites)
:::

## Quarto Blogs

:::: columns

::: column

- Inherits Quarto site functionalities (navigation, search, etc.)

- Automatically generated list and RSS feeds

- Customizable home page (inspired by the R package [postcards](https://github.com/seankross/postcards))

:::

::: aside
Examples: <https://quarto.org/docs/blog/> and more in the [Gallery](https://quarto.org/docs/gallery/#websites)
:::

::: {.column .make-smaller}
```{.yaml filename="index.qmd (website with posts/)"}
---
title: "myblog"
listing:
  contents: posts
  sort: "date desc"
  type: default
  categories: true
---
```
<br> 
```{.yaml filename="posts/first-post/index.qmd"}
---
title: "Post With Code"
description: "Post description"
author: "Fizz McPhee"
date: "5/22/2021"
categories:
  - news
  - code
---
```
:::
::::

## {background-image=images/screenshot-blog.png}

## Quarto Books

- Inherits Quarto site functionalities (navigation, search, etc.)
- Supports cross-referencing between chapters
- Output formats include HTML, PDF, MS Word and ePub.

::: aside
Examples: <https://quarto.org/docs/gallery/#books>
:::

## Quarto Books

```{.yaml filename="_quarto.yml" code-line-numbers="|2|4-5|8-12|14|16-22"}
project:
  type: book

book:
  title: "mybook"
  author: "Jane Doe"
  date: "8/18/2021"
  chapters:
    - index.qmd
    - intro.qmd
    - summary.qmd
    - references.qmd

bibliography: references.bib

format:
  html:
    theme: cosmo
  pdf:
    documentclass: scrreport
  epub:
    cover-image: cover.png
```

##  {background-image="images/screenshot-book-hopr.png"}

## And much more...

- [Metadata shared by subfolder](https://quarto.org/docs/projects/quarto-projects.html#shared-metadata) with `_metadata.yml`
- [Run scripts before and after `quarto render` (_Project Scripts_)](https://quarto.org/docs/projects/scripts.html)
- [Creation of customized item lists](https://quarto.org/docs/websites/website-listings-custom.html)
- ...

## Your turn! 

```{r}
#| echo: false
countdown(minutes = 10)
```

::: {.callout}

# Turn your project into a website

1. Add an `index.qmd` to your existing `Quarto-101` project. 
2. Modify the `_quarto.yml` to make a website
3. `quarto preview` to see your website evolve
4. Add navigation to display your `new-penguins.qmd` report in a submenu of the `navbar`.
5. Customize your website! 
:::

::: callout-tip

## Learn to navigate in the doc!

Use the Quarto documentation on the `website` type to play with the options: <https://quarto.org/docs/websites/>
:::

## My turn

::: task
Let's now add a blog component to our website.

-   Add a folder called `posts` and create a few minimal blog post entries and collect these from a blog page using the [listings feature](https://quarto.org/docs/websites/website-listings.html).

-   Change the style of listings.
:::

# Computations

## When should code be re-run? {.smaller}

::: incremental
-   You might have a reason to re-run all code in a Quarto website (every single chunk in every single document) every time you render the website.

-   But, chances are, that's not what you want.

    -   Just playing around styling -- you probably don't want to run the code again

    -   Changed some code in a document -- you probably want to re-run the code in that document, but not necessarily others

    -   Made a big change affecting computations on many or all pages -- you probably want to re-run all code

-   `freeze` and `cache` options give you fine control over these decisions
:::

## Freeze {.smaller}

-   The `freeze` option controls when/if computational documents be re-rendered during a global project render:

``` yaml
execute:
  freeze: true  # never re-render during project render
```

``` yaml
execute:
  freeze: auto  # re-render only when source changes
```

``` yaml
execute:
  freeze: false  # always re-render
```

-   The `freeze` option is typically added to a `_metadata.yml` file within a specific directory, affecting all files in that directory.

-   For blogs, set `feeze` in `_metadata.yml` at the root of the `posts` directory.

-   You can have it only within specific subdirectories for more complex sites.

## Cache

-   Cache stores the results of computations for a specific file.

-   Cache invalidation is triggered by changes in chunk source code (or other cache attributes you've defined).

-   `cache` can also be set at the chunk level. Consider using the cache for computationally expensive chunks.

## Freeze vs. cache {.smaller}

-   Freeze option is typically set

    -   for the whole website in `_quarto.yml`, or

    -   for files within a directory in `_metadata.yml` in that directory

``` yaml
execute: 
  freeze: auto
```

-   Cache option is typically set for a given file or for individual chunk(s) in a file.

``` yaml
execute:
  cache: true
```

or

```{r}
#| echo: fenced
#| cache: true

1 + 1
```

# Publishing

## QuartoPub

-   [Quarto Pub](https://quartopub.com/) is a free publishing service for content created with Quarto. It is ideal for blogs, course or project websites, books, presentations, and personal hobby sites.

-   Publish with `quarto publish`:

``` {.bash filename="Terminal"}
quarto publish quarto-pub
```

-   Gain a `_publish.yml` that is safe to check into version control.

## Other venues

-   GitHub Pages
-   Posit Connect
-   Netlify
-   Confluence
-   [More venues](https://quarto.org/docs/publishing/other.html)

# Questions ?

::: fragment
Let's recap...

[[Next]{.button}](/4-synthese/)
:::


